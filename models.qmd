---
title: "Models"
editor: source
execute:
  echo: false
  message: false
  warning: false
---

``` {r setup}
library(tidyverse)
library(janitor)
library(scales)
library(rstanarm)
```

```{r read initial datasets}
temp = read.csv("data/temperature_change.csv", fileEncoding="latin1") |> clean_names()
ltemp = read.csv("data/land_temperatures.csv") |> clean_names()
carbon = read.csv("data/carbon_dioxide_emissions.csv") |> clean_names()
methane = read.csv("data/methane_emissions.csv") |> clean_names()
```

```{r clean temp}
temp2 = temp |>
  select(area, months, element, y1990:y2018) |>
  pivot_longer(cols = y1990:y2018,
               names_prefix = "y",
               names_to = "year",
               values_to = "value") |>
  transform(year = as.numeric(year)) |>
  filter(element == "Temperature change") |>
  rename("country"="area") |>
  summarize("temperature_change" = sum(value), .by = c(country, year))
```

```{r clean ltemp}
ltemp2 = ltemp |>
  drop_na() |>
  mutate(dt = substr(dt, 1, 4)) |>
  filter(dt >= 1990 & dt <= 2018) |>
  transform(year = as.numeric(dt)) |>
  summarize(average_temperature = mean(average_temperature),
            average_temperature_uncertainty = mean (average_temperature_uncertainty),
            .by = year)
```


```{r clean carbon}
carbon2 = carbon |>
  select(country, x2018:x1990) |>
  mutate(x1990 = na_if(x1990, "N/A")) |>
  drop_na() |>
  transform(x1990 = as.numeric(x1990)) |>
  pivot_longer(cols = x1990:x2018,
               names_prefix = "x",
               names_to = "year",
               values_to = "carbon_dioxide_emissions") |>
  transform(year = as.numeric(year)) |>
  arrange(country)
```

```{r clean methane}
methane2 = methane |>
  select(country, x2018:x1990) |>
  mutate(x1990 = na_if(x1990, "N/A")) |>
  drop_na() |>
  transform(x1990 = as.numeric(x1990)) |>
  pivot_longer(cols = x1990:x2018,
               names_prefix = "x",
               names_to = "year",
               values_to = "methane_emissions") |>
  transform(year = as.numeric(year)) |>
  arrange(country)
```

```{r make joined}
joined = full_join(temp2, carbon2) |>
  full_join(ltemp2) |>
  filter(country != "World")
joined
```

## Carbon Dioxide By Year

The graph below shows the amount of C02 by metric tons in the world each year. After hearing from many other different sources that there carbon dioxide is increasing in the air, I predicted that my graph would also show that it is increasing. 

``` {r c02 by year}
joined |>
  summarize("carbon_dioxide_emissions_sum" = sum(carbon_dioxide_emissions, na.rm = TRUE),
            .by=year) |>
  ggplot(aes(x=year,
             y=carbon_dioxide_emissions_sum,
             group=1)) +
  geom_point() +
  geom_line() +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
  scale_x_continuous(limits = c(1990, 2018), breaks = seq(from=1990, to=2018, by=1)) +
  labs(x="Year",
       y="Carbon Dioxide Emissions (MtC02e)",
       title="Carbon Dioxide Emissions As Time Goes On",
       subtitle="carbon dioxide increases rapidly as time goes on")
```

The graph shows a strong positive correlation between year and carbon dioxide, but there are still some times when carbon dioxide has decreased for a short period. These times include 1992, 1998, 1999, 2009, 2011 and 2015. 

## Temperature Change by Year
```{r temp by Year}
joined |>
  summarize("temperature_change_mean" = mean(temperature_change, na.rm = TRUE),
            .by=year) |>
  transform(year = as.numeric(year)) |>
  ggplot(aes(x = year,
             y = temperature_change_mean,
             color = temperature_change_mean)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  scale_colour_gradient(low="#fcba03", high="#de2d26") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1),
        legend.position = "none") +
  scale_x_continuous(limits = c(1990, 2018), breaks = seq(from=1990, to=2018, by=1)) +
  labs(title = "Temperature Change Over Time",
       subtitle = "temperature is changing faster and faster",
       x = "Year",
       y = "Temperature Change (Celcius)")
```

## Land Temperature by Year
```{r}
ltemp2 |>
  ggplot(aes(x = year,
             y = average_temperature)) +
  geom_pointrange(aes(ymin = average_temperature - average_temperature_uncertainty,
                  ymax = average_temperature + average_temperature_uncertainty)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1)) +
  scale_x_continuous(limits = c(1990, 2013), breaks = seq(from=1990, to=2013, by=1)) +
  labs(title = "Land Temperature by Year",
       subtitle = "land temperature is slowly increasing",
       x = "Year",
       y = "Average Land Temperature (celcius)")
```

